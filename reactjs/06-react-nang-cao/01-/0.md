---
title: ""
description: ""
chapter:
  name: "React nâng cao"
  slug: "chuong-06-react-nang-cao"
image: https://kungfutech.edu.vn/thumbnail.png
position: 1
---

Trong React, có những tình huống bạn cần phải tương tác và đồng bộ hóa với các hệ thống bên ngoài của React. Ví dụ, bạn có thể cần tập trung vào một trường nhập bằng API của trình duyệt, chạy và tạm dừng một trình phát video không sử dụng React, hoặc kết nối và lắng nghe các thông báo từ máy chủ từ xa. Trong chương này, bạn sẽ tìm hiểu về những cách thoát ra khỏi React và kết nối với các hệ thống bên ngoài. Tuy nhiên, hãy nhớ rằng hầu hết logic ứng dụng và luồng dữ liệu của bạn không nên phụ thuộc vào các tính năng này.

## Nhớ thông tin mà không gây ra render lại

Khi bạn muốn một thành phần nhớ một số thông tin nhất định, nhưng bạn không muốn thông tin đó gây ra việc render lại, bạn có thể sử dụng `ref`. Ví dụ:

```jsx
import { useRef } from "react";

export default function Counter() {
  let ref = useRef(0);

  function handleClick() {
    ref.current = ref.current + 1;
    alert("Bạn đã nhấp chuột " + ref.current + " lần!");
  }

  return <button onClick={handleClick}>Nhấp vào tôi!</button>;
}
```

`ref` tương tự như một khu vực riêng tư trong thành phần của bạn mà React không theo dõi. Bạn có thể sử dụng `ref` để lưu trữ các ID thời gian chờ, các phần tử DOM và các đối tượng khác không ảnh hưởng đến kết quả đầu ra của thành phần.

## Quản lý DOM với refs

React thường tự động cập nhật DOM để phù hợp với đầu ra render của bạn, vì vậy các thành phần của bạn không thường xuyên cần phải thao tác trên DOM. Tuy nhiên, đôi khi bạn có thể cần truy cập các phần tử DOM được quản lý bởi React, ví dụ như để tập trung vào một nút, cuộn đến nó hoặc đo kích thước và vị trí của nó. Không có cách tích hợp sẵn để làm những điều đó trong React, vì vậy bạn sẽ cần một `ref` để truy cập đối tượng DOM. Ví dụ:

```jsx
import { useRef } from "react";

export default function Form() {
  const inputRef = useRef(null);

  function handleClick() {
    inputRef.current.focus();
  }

  return (
    <>
      <input ref={inputRef} />
      <button onClick={handleClick}>Tập trung vào nút này</button>
    </>
  );
}
```

## Đồng bộ hóa với Hiệu ứng sử dụng useRef

Một số thành phần cần phải đồng bộ hóa với các hệ thống bên ngoài. Ví dụ, bạn có thể muốn điều khiển một thành phần không sử dụng React dựa trên trạng thái React, thiết lập kết nối với máy chủ, hoặc gửi nhật ký phân tích khi một thành phần xuất hiện trên màn hình. Hiệu ứng cho phép bạn chạy mã sau khi render. Sử dụng chúng để đồng bộ hóa thành phần của bạn với hệ thống bên ngoài React. Ví dụ:

```jsx
import { useState, useRef, useEffect } from "react";

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  useEffect(() => {
    if (isPlaying) {
      ref.current.play();
    } else {
      ref.current.pause();
    }
  }, [isPlaying]);

  return <video ref={ref} src={src} loop playsInline />;
}

export default function App() {
  const [isPlaying, setIsPlaying] = useState(false);
  return (
    <>
      <button onClick={() => setIsPlaying(!isPlaying)}>
        {isPlaying ? "Tạm dừng" : "Chơi"}
      </button>
      <VideoPlayer
        isPlaying={isPlaying}
        src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      />
    </>
  );
}
```

Nhiều Hiệu ứng cũng "dọn dẹp" sau mình. Ví dụ, một Hiệu ứng thiết lập kết nối đến máy chủ chat nên trả về một hàm dọn dẹp để cho React biết cách ngắt kết nối thành phần của bạn từ máy chủ đó.

```jsx
import { useState, useEffect } from "react";
import { createConnection } from "./chat.js";

export default function ChatRoom() {
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, []);
  return <h1>Chào mừng bạn đến với cuộc trò chuyện!</h1>;
}
```

## Bạn Có Thể Không Cần Hiệu ứng

Hiệu ứng là cách thoát ra khỏi mô hình React. Chúng cho phép bạn "bước ra ngoài" của React và đồng bộ hóa các thành phần của bạn với một hệ thống bên ngoài. Nếu không có hệ thống bên ngoài (ví dụ: bạn muốn cập nhật trạng thái của một thành phần khi một số thuộc tính hoặc trạng thái thay đổi), bạn có thể không cần Hiệu ứng. Loại bỏ các Hiệu ứng không cần thiết sẽ làm cho mã của bạn dễ theo dõi hơn, chạy nhanh hơn và ít gây lỗi hơn.

Có hai trường hợp phổ biến khi bạn không cần Hiệu ứng:

- Bạn không cần Hiệu ứng để biến đổi dữ liệu cho việc render.
- Bạn không cần Hiệu ứng để xử lý sự kiện của người dùng.

## Vòng đời của Hiệu ứng

Hiệu ứng có vòng đời khác biệt so với các thành phần. Các thành phần có thể được gắn kết, cập nhật hoặc hủy gắn kết. Một Hiệu ứng chỉ có thể thực hiện hai việc: bắt đầu đồng bộ hóa một cái gì đó và sau đó dừng đồng bộ hóa nó. Chu kỳ này có thể xảy ra nhiều lần nếu Hiệu ứng của bạn phụ thuộc vào các thuộc tính và trạng thái thay đổi theo thời gian.

## Tách sự kiện khỏi Hiệu ứng

Thay vì sử dụng Hiệu ứng để xử lý sự kiện của người dùng, bạn có thể tạo một API thử nghiệm để tạo sự kiện chỉ chạy lại khi bạn thực hiện cùng một tương tác. Khác với sự kiện của người dùng, Hiệu ứng sẽ đồng bộ lại nếu bất kỳ giá trị nào mà chúng đọc, như props hoặc trạng thái, khác so với lần render cuối cùng. Đôi khi, bạn muốn kết hợp cả hai hành vi: một Hiệu ứng chạy lại dựa trên một số giá trị nhưng không dựa trên giá trị khác.

## Loại bỏ các phụ thuộc của Hiệu ứng

Khi bạn viết một Hiệu ứng, linter sẽ kiểm tra xem bạn đã bao gồm tất cả các giá trị phản ứng (như props và trạng thái) mà Hiệu ứng đọc trong danh sách các phụ thuộc của Hiệu ứng của bạn chưa. Điều này đảm bảo rằng Hiệu ứng của bạn vẫn đồng bộ với props và trạng thái mới nhất của thành phần của bạn. Những phụ thuộc không cần thiết có thể làm cho Hiệu ứng của bạn chạy quá thường xuyên hoặc thậm chí tạo ra một vòng lặp vô tận. Cách bạn loại bỏ chúng phụ thuộc vào trường hợp cụ thể.

## Tái sử dụng logic với Hooks tùy chỉnh

Ngoài các Hooks tích hợp sẵn như `useState`, `useContext` và `useEffect`, bạn có thể tạo ra các Hooks tùy chỉnh cho các mục đích cụ thể trong ứng dụng của bạn. Ví dụ, để truy xuất dữ liệu, theo dõi trạng thái trực tuyến của người dùng hoặc kết nối với một phòng trò chuyện. Bạn có thể tạo ra các Hooks tùy chỉnh cho các nhu cầu của ứng dụng của bạn, và khi ứng dụng của bạn phát triển, bạn sẽ viết ít Hiệu ứng hơn bằng tay vì bạn có thể tái sử dụng các Hooks tùy chỉnh bạn đã viết hoặc sử dụng các Hooks tùy chỉnh được cộng đồng React duy trì.
